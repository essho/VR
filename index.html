<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>VR Simple Grab - Native</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <script>
        AFRAME.registerComponent('simple-grab', {
            init: function () {
                this.heldObject = null;
                this.raycaster = this.el.components.raycaster;

                // تعريف الأحداث لليد والكنترولر
                // gripdown: زر القبضة في الكنترولر
                // pinchstarted: حركة القرص في تتبع اليد
                this.el.addEventListener('gripdown', this.onGrab.bind(this));
                this.el.addEventListener('pinchstarted', this.onGrab.bind(this));

                // gripup: ترك زر القبضة
                // pinchend: فك القرص
                this.el.addEventListener('gripup', this.onRelease.bind(this));
                this.el.addEventListener('pinchend', this.onRelease.bind(this));
            },

            onGrab: function (evt) {
                // البحث عن أقرب عنصر يتقاطع معه الشعاع
                let intersections = this.el.components.raycaster.getIntersection(document.querySelectorAll('.grabbable'));
                
                if (intersections.length > 0 && !this.heldObject) {
                    // العنصر الذي سنمسكه
                    let object = intersections[0].object.el;
                    
                    // تغيير لون مؤقت للدلالة على المسك
                    object.setAttribute('opacity', 0.5);

                    // جعل العنصر "ابن" لليد لكي يتحرك معها (Parenting)
                    this.heldObject = object;
                    this.el.object3D.attach(this.heldObject.object3D);
                }
            },

            onRelease: function (evt) {
                if (this.heldObject) {
                    // إعادة اللون لطبيعته
                    this.heldObject.setAttribute('opacity', 1.0);

                    // فك ارتباط العنصر باليد وإعادته للمشهد الرئيسي
                    this.el.sceneEl.object3D.attach(this.heldObject.object3D);
                    
                    this.heldObject = null;
                }
            }
        });
    </script>
</head>
<body>

    <a-scene webxr="optionalFeatures: hand-tracking" background="color: #ECECEC">

        <a-entity id="rig" position="0 0 0">
            <a-camera position="0 1.6 0"></a-camera>

            <a-entity 
                simple-grab
                hand-controls="hand: left; handModelStyle: highPoly"
                hand-tracking-controls="hand: left"
                raycaster="objects: .grabbable; far: 0.1; showLine: false"
                collider-check>
            </a-entity>

            <a-entity 
                simple-grab
                hand-controls="hand: right; handModelStyle: highPoly"
                hand-tracking-controls="hand: right"
                raycaster="objects: .grabbable; far: 0.1; showLine: false"
                collider-check>
            </a-entity>
        </a-entity>

        <a-box class="grabbable" position="-0.5 1.3 -0.5" color="#4CC3D9" width="0.2" height="0.2" depth="0.2"></a-box>

        <a-sphere class="grabbable" position="0 1.3 -0.5" color="#EF2D5E" radius="0.1"></a-sphere>

        <a-cylinder class="grabbable" position="0.5 1.3 -0.5" color="#FFC65D" radius="0.1" height="0.2"></a-cylinder>

        <a-box position="0 1 -0.5" width="2" height="0.1" depth="1" color="#7BC8A4"></a-box>
        
        <a-plane position="0 0 0" rotation="-90 0 0" width="10" height="10" color="#333"></a-plane>

    </a-scene>
</body>
</html>